@using MudBlazor
@using DanplannerBooking.Application.Dtos.Booking

<MudDateRangePicker DateRange="@SelectedRange"
                    DateRangeChanged="OnDateRangeChanged"
                    AdditionalDateClassesFunc="GetDayClass"
                    IsDateDisabledFunc="IsDateDisabled"
                    PickerVariant="PickerVariant.Static"
                    Variant="Variant.Outlined"
                    Class="w-100" />

@code {
    // 1. Gør denne nullable (?)
    [Parameter] public DateRange? SelectedRange { get; set; }

    // 2. Opdater EventCallback til også at kunne sende null tilbage (?)
    [Parameter] public EventCallback<DateRange?> SelectedRangeChanged { get; set; }

    [Parameter] public List<BookingRangeDto> UnavailableRanges { get; set; } = new();

    // 3. Opdater metoden til at tage imod DateRange?
    private async Task OnDateRangeChanged(DateRange? range)
    {
        SelectedRange = range;
        await SelectedRangeChanged.InvokeAsync(range);
    }

    private string GetDayClass(DateTime date)
    {
        if (UnavailableRanges == null || UnavailableRanges.Count == 0)
            return "mud-available-day";

        foreach (var range in UnavailableRanges)
        {
            if (date.Date >= range.Start.Date && date.Date <= range.End.Date)
                return "mud-unavailable-day";
        }

        return "mud-available-day";
    }

    private bool IsDateDisabled(DateTime date)
    {
        if (UnavailableRanges == null || UnavailableRanges.Count == 0)
            return false;

        foreach (var range in UnavailableRanges)
        {
            if (date.Date >= range.Start.Date && date.Date <= range.End.Date)
                return true;
        }

        return false;
    }
}