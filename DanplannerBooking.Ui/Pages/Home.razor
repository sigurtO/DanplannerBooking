@page "/"
@using DanplannerBooking.Application.Dtos.Campsite
@inject HttpClient Http
@inject NavigationManager Nav

<!-----------------------------------------------------------------Main---------------------------------------------------------------------------->
<main class="booking-main">
 <h3>Campsites</h3>
 @if (campsites == null)
 {
 <p>Loading campsites...</p>
 }
 else if (!campsites.Any())
 {
 <p>No campsites available.</p>
 }
 else
 {
 <div class="row">
 @foreach (var camp in campsites)
 {
 <div class="col-md-4 mt-3">
 <div class="card shadow-sm p-3">
 <div style="height:150px; overflow: hidden; border-radius:6px; margin-bottom:8px;">
 <img src="@GetImageSrc(camp.Image)" alt="@camp.Name" style="width:100%; height:100%; object-fit: cover; display: block;" />
 </div>

 <h4>@camp.Name</h4>
 <p>@camp.Description</p>

 <button class="btn btn-primary"
 @onclick="() => OpenBookingChoice(camp.Id)">
 Book now
 </button>
 </div>
 </div>
 }
 </div>
 }

 @if (showBookingChoice)
 {
 <div class="bb-modal-backdrop" @onclick="CancelBookingChoice">
 <div class="bb-modal" @onclick:stopPropagation>
 <h5>Vælg type</h5>
 <p>Vil du booke en plads eller en hytte på <strong>@(bookingCampsiteName ?? "den valgte campingplads")</strong>?</p>
 <div class="actions">
 <button class="btn btn-secondary" @onclick="CancelBookingChoice">Annuller</button>
 <button class="btn btn-outline-primary" @onclick="ChooseSpace">Plads</button>
 <button class="btn btn-primary" @onclick="ChooseCottage">Hytte</button>
 </div>
 </div>
 </div>
 }

 @code {
 private List<CampsiteResponseDto>? campsites;
 private bool showBookingChoice = false;
 private Guid? bookingCampsiteId;
 private string? bookingCampsiteName;

 protected override async Task OnInitializedAsync()
 {
 campsites = await Http.GetFromJsonAsync<List<CampsiteResponseDto>>("api/Campsite");
 }

 private void GoToDetails(Guid id)
 {
 Nav.NavigateTo($"/book-campsite/{id}");
 }

 private string GetImageSrc(byte[]? image)
 {
 if (image is null || image.Length ==0) return "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='%23e9e9e9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23777' font-size='20'>No image</text></svg>";
 try
 {
 return $"data:image/png;base64,{Convert.ToBase64String(image)}";
 }
 catch
 {
 return "";
 }
 }

 private void OpenBookingChoice(Guid campsiteId)
 {
 bookingCampsiteId = campsiteId;
 bookingCampsiteName = campsites?.FirstOrDefault(c => c.Id == campsiteId)?.Name;
 showBookingChoice = true;
 }

 private void CancelBookingChoice() => showBookingChoice = false;

 private void ChooseSpace()
 {
 showBookingChoice = false;
 if (bookingCampsiteId.HasValue)
 Nav.NavigateTo($"/user-space?campsiteId={bookingCampsiteId}");
 else
 Nav.NavigateTo("/user-space");
 }

 private void ChooseCottage()
 {
 showBookingChoice = false;
 if (bookingCampsiteId.HasValue)
 Nav.NavigateTo($"/user-cottages?campsiteId={bookingCampsiteId}");
 else
 Nav.NavigateTo("/user-cottages");
 }
 }
 <!--man skal kunne vælge cotteges og spaces. Skal gå til den arkuelle side. opret ny side da cottage admin og spaces admin bliver fjernet-->

</main>

<!-----------------------------------------------------------------footer---------------------------------------------------------------------------->
<footer> <div class="gridcontainer">
<div class="f1"><h4>Danline Innovation A/S</h4>
<p>Lumbyesvej29</p>
<p>7000 Fredericia</p>
<p>CVR:25831152</p>
</div>
<div class="f2"><h4>Kontakt</h4>
<p>mads@danline.dk</p>
<p>+4576206040</p>
<p>Handelsbetingelser</p>
</div>
<div class="f3"><img src="" alt="">
<h4>Brands</h4>
<p>Danplanner</p>
<p>Danbase</p>
</div>
<div class="f4">
<h4>Sociale medier</h4>
<p>Facebook</p>
<p>Linkedin</p>
</div></div>
</footer>
<style>
 footer{
 margin-top:10px;
 }
 .gridcontainer {
 display: felx;
 display: grid;
 grid-template-columns: repeat(41fr);
 grid-template-rows: auto;
 background-color: #f4f4f4;
 align-items: flex-start;
}
.f1{
 grid-area:1/1/2/2 ;
}
.f2{
grid-area:1/2/2/3 ;
}
.f3{
grid-area:1/3/2/4 ;
}
.f4{
 grid-area:1/4/2/5 ; 
}
</style>
